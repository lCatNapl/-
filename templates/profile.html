profile
{% extends "base.html" %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å - {{ current_user.username }}{% endblock %}

{% block content %}
<div class="profile-hero">
    <div class="profile-header">
        <div class="avatar-section">
            <div class="avatar-container">
                {% if current_user.avatar %}
                    <img src="{{ current_user.avatar }}" alt="–ê–≤–∞—Ç–∞—Ä" class="avatar">
                {% else %}
                    <div class="avatar-placeholder" style="background-color: {{ current_user.profile_color }};">
                        <i class="fas fa-user"></i>
                    </div>
                {% endif %}
                <label for="avatar-upload" class="avatar-upload-btn">
                    <i class="fas fa-camera"></i>
                    <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                </label>
            </div>
        </div>
        
        <div class="profile-info">
            <h2>{{ current_user.username }}</h2>
            <div class="subscription-status">
                <span class="status-badge status-{{ current_user.subscription_type }}">
                    {{ current_user.subscription_type.upper() }}
                </span>
                {% if current_user.subscription_end %}
                    <span class="subscription-date">
                        –î–æ: {{ current_user.subscription_end.strftime('%d.%m.%Y') }}
                    </span>
                {% else %}
                    <span class="subscription-lifetime">–ù–∞–≤—Å–µ–≥–¥–∞</span>
                {% endif %}
            </div>
            <div class="user-stats">
                <span>Premium —Å–ª–æ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {{ current_user.premium_slots_used }}/1</span>
                <span>VIP —Å–ª–æ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {{ current_user.vip_slots_used }}/3</span>
            </div>
        </div>
    </div>
</div>

<div class="profile-content">
    <div class="profile-tabs">
        <button class="tab-btn active" data-tab="settings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button class="tab-btn" data-tab="subscriptions">üíé –ü–æ–¥–ø–∏—Å–∫–∏</button>
        <button class="tab-btn" data-tab="telegram">üì± Telegram</button>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settings" class="tab-content active">
        <form method="POST" enctype="multipart/form-data" class="profile-form">
            {{ form.hidden_tag() }}
            
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" name="username" value="{{ current_user.username }}" required>
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" value="{{ current_user.email }}" required>
            </div>
            
            <div class="form-group">
                <label>–¶–≤–µ—Ç –ø—Ä–æ—Ñ–∏–ª—è</label>
                <input type="color" name="profile_color" value="{{ current_user.profile_color }}">
                <span class="color-preview" style="background-color: {{ current_user.profile_color }};"></span>
            </div>
            
            <div class="form-group">
                <label>–°—Å—ã–ª–∫–∞ –Ω–∞ Telegram</label>
                <input type="url" name="telegram_link" value="{{ current_user.telegram_link }}" 
                       placeholder="https://t.me/yourchannel">
            </div>
            
            <button type="submit" class="btn btn-primary btn-large">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ü–æ–¥–ø–∏—Å–∫–∏ -->
    <div id="subscriptions" class="tab-content">
        <h3>–¢–µ–∫—É—â–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: <strong>{{ current_user.subscription_type.upper() }}</strong></h3>
        
        <div class="upgrade-section">
            <h4>–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</h4>
            <div class="pricing-grid">
                {% for plan in plans %}
                <div class="plan-card plan-{{ plan.name }} 
                    {% if current_user.subscription_type == plan.name %}active current-plan{% endif %}">
                    <h5>{{ plan.name.upper() }}</h5>
                    <div class="price">
                        {% if plan.price == 0 %}–ë–µ—Å–ø–ª–∞—Ç–Ω–æ{% else %}{{ plan.price }}‚ÇΩ/–º–µ—Å{% endif %}
                    </div>
                    <ul>
                        {% if plan.name == 'start' %}
                            <li>‚úÖ –ë–∞–∑–æ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–∞—Ç–∞–ª–æ–≥—É</li>
                            <li>üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</li>
                        {% elif plan.name == 'vip' %}
                            <li>üé® –ù–æ–≤—ã–µ —Ç–µ–º—ã –∏ —Ü–≤–µ—Ç–∞</li>
                            <li>üñºÔ∏è –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</li>
                            <li>üèÜ –°—Ç–∞—Ç—É—Å VIP</li>
                            <li><strong>üéÅ 3 —Å–ª–æ—Ç–∞ –Ω–∞–≤—Å–µ–≥–¥–∞</strong></li>
                        {% elif plan.name == 'premium' %}
                            <li>‚≠ê –õ—É—á—à–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</li>
                            <li>üï∂Ô∏è 3D –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</li>
                            <li>üíé –õ—É—á—à–∏–µ —Ç–µ–º—ã</li>
                            <li><strong>üéÅ 1 Premium + 3 VIP –Ω–∞–≤—Å–µ–≥–¥–∞</strong></li>
                        {% endif %}
                    </ul>
                    {% if current_user.subscription_type != plan.name %}
                        <a href="{{ url_for('subscribe', plan_name=plan.name) }}" 
                           class="btn btn-{{ plan.name }}">
                            –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ {{ plan.name.upper() }}
                        </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ Telegram -->
    <div id="telegram" class="tab-content">
        <div class="telegram-section">
            <h4>–ü—Ä–∏–≤—è–∑–∞—Ç—å Telegram –∞–∫–∫–∞—É–Ω—Ç</h4>
            <p>–ü–æ–ª—É—á–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É</p>
            
            <button id="generate-telegram-link" class="btn btn-outline">
                <i class="fab fa-telegram"></i> –°–æ–∑–¥–∞—Ç—å —Å—Å—ã–ª–∫—É
            </button>
            
            <div id="telegram-result" style="display: none; margin-top: 1rem;">
                <p>–ü–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ –≤ Telegram:</p>
                <div class="telegram-link-container">
                    <input type="text" id="telegram-url" readonly>
                    <button id="copy-telegram-link" class="btn-copy">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
            
            {% if current_user.telegram_link %}
                <div class="telegram-connected">
                    <i class="fas fa-check-circle"></i>
                    <p>Telegram —É–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω: <a href="{{ current_user.telegram_link }}" target="_blank">{{ current_user.telegram_link }}</a></p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
    document.getElementById('avatar-upload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const formData = new FormData();
            formData.append('avatar', file);
            
            fetch('{{ url_for("profile") }}', {
                method: 'POST',
                body: formData
            }).then(() => location.reload());
        }
    });

    // –í–∫–ª–∞–¥–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(btn.dataset.tab).classList.add('active');
        });
    });

    // Telegram —Å—Å—ã–ª–∫–∞
    document.getElementById('generate-telegram-link').addEventListener('click', function() {
        fetch('{{ url_for("link_telegram") }}')
            .then(response => response.json())
            .then(data => {
                document.getElementById('telegram-url').value = data.telegram_link;
                document.getElementById('telegram-result').style.display = 'block';
                document.getElementById('generate-telegram-link').textContent = '–°—Å—ã–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!';
            });
    });

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
    document.getElementById('copy-telegram-link').addEventListener('click', function() {
        navigator.clipboard.writeText(document.getElementById('telegram-url').value);
        this.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        setTimeout(() => this.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 2000);
    });
});
</script>
{% endblock %}
